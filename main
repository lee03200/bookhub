<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BookHub - 互动式书籍推荐与评价平台</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .star-rating {
            display: flex;
            gap: 4px;
        }

        .star {
            cursor: pointer;
            transition: color 0.2s;
        }

        .star.filled {
            color: #fbbf24;
        }

        .book-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .vip-badge {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #fff;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        .plan-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .plan-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(118, 75, 162, 0.15);
        }

        .plan-card.highlight {
            border-color: #764ba2;
            position: relative;
            transform: scale(1.02);
        }

        .plan-card.highlight::before {
            content: "最受欢迎";
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #764ba2;
            color: white;
            padding: 2px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
    </style>
</head>

<body class="bg-gray-50">
    <div id="app">
        <!-- 导航栏 -->
        <nav class="bg-white shadow-lg sticky top-0 z-50">
            <div class="container mx-auto px-4">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-book text-3xl text-indigo-600"></i>
                        <h1 class="text-2xl font-bold text-gray-800">BookHub</h1>
                    </div>

                    <!-- 搜索栏 -->
                    <div class="hidden md:flex flex-1 max-w-md mx-8">
                        <div class="relative w-full">
                            <input type="text" placeholder="搜索书籍、作者或ISBN..."
                                class="w-full px-4 py-2 pl-10 pr-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                v-model="searchKeyword" @input="handleSearch">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        </div>
                    </div>

                    <!-- 导航菜单 -->
                    <div class="hidden md:flex items-center space-x-6">
                        <a href="#" class="text-gray-700 hover:text-indigo-600 transition" @click="goToHome">首页</a>
                        <a href="#popular-books" class="text-gray-700 hover:text-indigo-600 transition"
                            @click="scrollToPopular">热门书籍</a>
                        <a href="#" class="text-gray-700 hover:text-indigo-600 transition" @click="goToMyShelf">我的书架</a>
                        <!-- 新增会员入口 -->
                        <button class="flex items-center text-indigo-600 hover:text-indigo-800 transition" @click="showVipModal">
                            <i class="fas fa-crown mr-1"></i>
                            <span>会员</span>
                            <span v-if="userInfo.isVip" class="ml-1 px-1.5 py-0.5 text-xs rounded-full vip-badge">VIP</span>
                        </button>
                        <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition"
                            @click="showLoginModal">
                            {{ isLoggedIn ? '个人中心' : '登录/注册' }}
                        </button>
                    </div>

                    <!-- 移动端菜单按钮 -->
                    <button @click="mobileMenuOpen = !mobileMenuOpen" class="md:hidden">
                        <i class="fas fa-bars text-2xl text-gray-700"></i>
                    </button>
                </div>

                <!-- 移动端菜单 -->
                <div v-if="mobileMenuOpen" class="md:hidden pb-4">
                    <div class="flex flex-col space-y-2">
                        <input type="text" placeholder="搜索书籍..."
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg" v-model="searchKeyword"
                            @input="handleSearch">
                        <a href="#" class="text-gray-700 hover:text-indigo-600 py-2" @click="goToHome">首页</a>
                        <a href="#popular-books" class="text-gray-700 hover:text-indigo-600 py-2"
                            @click="scrollToPopular">热门书籍</a>
                        <a href="#" class="text-gray-700 hover:text-indigo-600 py-2" @click="goToMyShelf">我的书架</a>
                        <button class="flex items-center text-indigo-600 hover:text-indigo-800 py-2" @click="showVipModal">
                            <i class="fas fa-crown mr-1"></i>
                            <span>会员</span>
                            <span v-if="userInfo.isVip" class="ml-1 px-1.5 py-0.5 text-xs rounded-full vip-badge">VIP</span>
                        </button>
                        <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700"
                            @click="showLoginModal">
                            {{ isLoggedIn ? '个人中心' : '登录/注册' }}
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- 主要内容区域 -->
        <main class="container mx-auto px-4 py-8">
            <!-- 英雄区域 -->
            <section class="gradient-bg rounded-2xl text-white p-8 mb-12">
                <div class="max-w-4xl mx-auto text-center">
                    <h2 class="text-4xl md:text-6xl font-bold mb-6">发现你的下一本好书</h2>
                    <p class="text-xl mb-8 opacity-90">基于智能推荐和真实评价，为你精选最适合的阅读选择</p>
                    <div class="flex flex-col sm:flex-row gap-4 justify-center">
                        <button
                            class="glass-effect text-white px-8 py-3 rounded-lg font-semibold hover:bg-white hover:bg-opacity-20 transition"
                            @click="scrollToCategories">
                            开始探索
                        </button>
                        <button
                            class="bg-white text-indigo-600 px-8 py-3 rounded-lg font-semibold hover:bg-gray-100 transition"
                            @click="showRecommendations">
                            查看推荐
                        </button>
                    </div>
                </div>
            </section>

            <!-- 会员特权展示区 -->
            <section class="mb-12 bg-white rounded-lg shadow-md p-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">会员专享特权</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="text-center p-4 rounded-lg bg-indigo-50">
                        <div class="w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-book-open text-2xl text-indigo-600"></i>
                        </div>
                        <h4 class="font-semibold text-gray-800 mb-2">无限阅读</h4>
                        <p class="text-gray-600 text-sm">畅读平台所有付费书籍，无阅读限制</p>
                    </div>
                    <div class="text-center p-4 rounded-lg bg-indigo-50">
                        <div class="w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-download text-2xl text-indigo-600"></i>
                        </div>
                        <h4 class="font-semibold text-gray-800 mb-2">离线下载</h4>
                        <p class="text-gray-600 text-sm">支持下载任意书籍，随时随地阅读</p>
                    </div>
                    <div class="text-center p-4 rounded-lg bg-indigo-50">
                        <div class="w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-gift text-2xl text-indigo-600"></i>
                        </div>
                        <h4 class="font-semibold text-gray-800 mb-2">专属福利</h4>
                        <p class="text-gray-600 text-sm">每月免费领取精选新书，参与会员活动</p>
                    </div>
                </div>
                <div class="text-center mt-6">
                    <button class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 transition" @click="showVipModal">
                        立即开通会员
                    </button>
                </div>
            </section>

            <!-- 推荐区域 -->
            <section class="mb-12">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800">为你推荐</h3>
                </div>

                <div v-if="recommendedBooks.length === 0" class="text-center py-12 bg-white rounded-lg shadow">
                    <i class="fas fa-search text-5xl text-gray-300 mb-4"></i>
                    <p class="text-gray-500">未找到相关书籍</p>
                </div>

                <div v-else class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div v-for="book in recommendedBooks" :key="book.id"
                        class="book-card bg-white rounded-lg shadow-md overflow-hidden cursor-pointer"
                        @click="openBookDetail(book)">

                        <div class="aspect-[3/4] bg-gradient-to-br from-gray-200 to-gray-300 relative">
                            <img :src="book.cover" :alt="book.title" class="w-full h-full object-cover">
                            <div v-if="book.isPremium && !userInfo.isVip" class="absolute top-2 right-2 bg-red-500 text-white text-xs px-2 py-1 rounded">
                                会员专享
                            </div>
                        </div>
                        <div class="p-4">
                            <h4 class="font-bold text-gray-800 mb-2 truncate">{{ book.title }}</h4>
                            <p class="text-gray-600 text-sm mb-3">{{ book.author }}</p>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-1">
                                    <star-rating :rating="book.rating" :readonly="true"></star-rating>
                                    <span class="text-sm text-gray-600">{{ book.rating }}</span>
                                </div>
                                <span class="text-sm text-gray-500">{{ book.reviews }} 评价</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 热门书籍 -->
            <section id="popular-books" class="mb-12">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800">热门书籍</h3>
                    <button class="text-indigo-600 hover:text-indigo-800 font-semibold" @click="showFullRanking">
                        查看完整榜单 →
                    </button>
                </div>

                <div v-if="popularBooks.length === 0" class="text-center py-12 bg-white rounded-lg shadow">
                    <i class="fas fa-search text-5xl text-gray-300 mb-4"></i>
                    <p class="text-gray-500">未找到相关书籍</p>
                </div>

                <div v-else class="bg-white rounded-lg shadow-md p-6">
                    <div class="space-y-4">
                        <div v-for="(book, index) in popularBooks" :key="book.id"
                            class="flex items-center space-x-4 p-4 hover:bg-gray-50 rounded-lg cursor-pointer transition"
                            @click="openBookDetail(book)">
                            <div
                                class="flex-shrink-0 w-8 h-8 bg-indigo-600 text-white rounded-full flex items-center justify-center font-bold">
                                {{ index + 1 }}
                            </div>
                            <div
                                class="flex-shrink-0 w-16 h-20 bg-gradient-to-br from-gray-200 to-gray-300 rounded overflow-hidden relative">
                                <img :src="book.cover" :alt="book.title" class="w-full h-full object-cover">
                                <div v-if="book.isPremium && !userInfo.isVip" class="absolute top-1 right-1 bg-red-500 text-white text-xs px-1.5 py-0.5 rounded">
                                    会员
                                </div>
                            </div>
                            <div class="flex-1 min-w-0">
                                <h4 class="font-semibold text-gray-800 truncate">{{ book.title }}</h4>
                                <p class="text-gray-600 text-sm">{{ book.author }}</p>
                                <div class="flex items-center space-x-4 mt-2">
                                    <div class="flex items-center space-x-1">
                                        <star-rating :rating="book.rating" :readonly="true"></star-rating>
                                        <span class="text-sm text-gray-600">{{ book.rating }}</span>
                                    </div>
                                    <span class="text-sm text-gray-500">{{ book.genre }}</span>
                                    <span class="text-sm text-indigo-600 font-semibold">{{ book.heat }}° 热度</span>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="text-sm text-gray-500">{{ book.reviews }} 人评价</p>
                                <p class="text-xs text-gray-400 mt-1">{{ book.reading }} 人在读</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 分类筛选 -->
            <section class="mb-12">
                <h3 id="browse-categories" class="text-2xl font-bold text-gray-800 mb-6">浏览分类</h3>
                <div class="flex flex-wrap gap-3">
                    <button v-for="category in categories" :key="category" @click="filterByCategory(category)" :class="[
                            'px-4 py-2 rounded-full transition',
                            selectedCategory === category
                                ? 'bg-indigo-600 text-white'
                                : 'bg-white text-gray-700 hover:bg-gray-100 border border-gray-300'
                        ]">
                        {{ category }}
                    </button>
                </div>
            </section>

            <!-- 分类筛选结果展示 -->
            <section class="mb-12">
                <h3 class="text-2xl font-bold text-gray-800 mb-6">
                    {{ selectedCategory === '全部' ? '所有书籍' : selectedCategory + '类书籍' }}
                </h3>

                <div v-if="filteredBooks.length === 0" class="text-center py-12 bg-white rounded-lg shadow">
                    <i class="fas fa-search text-5xl text-gray-300 mb-4"></i>
                    <p class="text-gray-500">该分类下未找到相关书籍</p>
                </div>

                <div v-else class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div v-for="book in filteredBooks" :key="book.id"
                        class="book-card bg-white rounded-lg shadow-md overflow-hidden cursor-pointer"
                        @click="openBookDetail(book)">
                        <div class="aspect-[3/4] bg-gradient-to-br from-gray-200 to-gray-300 relative">
                            <img :src="book.cover" :alt="book.title" class="w-full h-full object-cover">
                            <div v-if="book.isPremium && !userInfo.isVip" class="absolute top-2 right-2 bg-red-500 text-white text-xs px-2 py-1 rounded">
                                会员专享
                            </div>
                        </div>
                        <div class="p-4">
                            <h4 class="font-bold text-gray-800 mb-2 truncate">{{ book.title }}</h4>
                            <p class="text-gray-600 text-sm mb-3">{{ book.author }}</p>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-1">
                                    <star-rating :rating="book.rating" :readonly="true"></star-rating>
                                    <span class="text-sm text-gray-600">{{ book.rating }}</span>
                                </div>
                                <span class="text-sm text-gray-500">{{ book.reviews }} 评价</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 我的书架 -->
            <section id="my-shelf" class="mb-12" v-if="isLoggedIn">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800">我的书架</h3>
                    <div class="flex items-center gap-4">
                        <span v-if="userInfo.isVip" class="text-sm text-green-600 bg-green-50 px-3 py-1 rounded-full flex items-center">
                            <i class="fas fa-check-circle mr-1"></i>
                            <span>会员可收藏无限书籍</span>
                        </span>
                        <span v-else class="text-sm text-blue-600 bg-blue-50 px-3 py-1 rounded-full flex items-center">
                            <i class="fas fa-info-circle mr-1"></i>
                            <span>普通用户可收藏 {{ myShelfBooks.length }}/10 本</span>
                        </span>
                        <button class="text-indigo-600 hover:text-indigo-800 font-semibold">
                            管理书架 →
                        </button>
                    </div>
                </div>

                <div v-if="myShelfBooks.length === 0" class="text-center py-12 bg-white rounded-lg shadow">
                    <i class="fas fa-book-reader text-5xl text-gray-300 mb-4"></i>
                    <p class="text-gray-500">书架为空，快去添加书籍吧</p>
                    <button class="mt-4 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition"
                        @click="browseBooks">
                        浏览书籍
                    </button>
                </div>

                <div v-else class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div v-for="book in myShelfBooks" :key="book.id"
                        class="book-card bg-white rounded-lg shadow-md overflow-hidden cursor-pointer"
                        @click="openBookDetail(book)">
                        <div class="aspect-[3/4] bg-gradient-to-br from-gray-200 to-gray-300">
                            <img :src="book.cover" :alt="book.title" class="w-full h-full object-cover">
                        </div>
                        <div class="p-4">
                            <h4 class="font-bold text-gray-800 mb-2 truncate">{{ book.title }}</h4>
                            <p class="text-gray-600 text-sm mb-3">{{ book.author }}</p>
                            <div class="flex items-center justify-center">
                                <div class="flex items-center space-x-1">
                                    <star-rating :rating="book.rating" :readonly="true"></star-rating>
                                    <span class="text-sm text-gray-600">{{ book.rating }}</span>
                                </div>
                                <button class="text-red-500 hover:text-red-700 text-sm"
                                    @click="removeFromShelf(book.id)">
                                    移除
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 未登录提示（我的书架区域） -->
            <section id="my-shelf" class="mb-12" v-else>
                <div class="text-center py-12 bg-white rounded-lg shadow">
                    <i class="fas fa-user-lock text-5xl text-gray-300 mb-4"></i>
                    <p class="text-gray-500 mb-4">登录后即可查看和管理你的书架</p>
                    <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition"
                        @click="showLoginModal">
                        立即登录
                    </button>
                </div>
            </section>

            <!-- 个人阅读足迹 -->
            <section>
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800">我的阅读足迹</h3>
                    <button class="text-indigo-600 hover:text-indigo-800 font-semibold" @click="showAllReadingHistory">
                        查看完整记录 →
                    </button>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div class="text-center p-4 bg-indigo-50 rounded-lg">
                            <div class="text-3xl font-bold text-indigo-600">{{ readingStats.total }}</div>
                            <div class="text-gray-600">总阅读数</div>
                        </div>
                        <div class="text-center p-4 bg-green-50 rounded-lg">
                            <div class="text-3xl font-bold text-green-600">{{ readingStats.thisMonth }}</div>
                            <div class="text-gray-600">本月阅读</div>
                        </div>
                        <div class="text-center p-4 bg-yellow-50 rounded-lg">
                            <div class="text-3xl font-bold text-yellow-600">{{ readingStats.avgRating }}</div>
                            <div class="text-gray-600">平均评分</div>
                        </div>
                    </div>

                    <div>
                        <h4 class="font-semibold text-gray-800 mb-4">最近在读</h4>
                        <div class="flex space-x-4 overflow-x-auto pb-2">
                            <div v-for="book in currentlyReading" :key="book.id"
                                class="flex-shrink-0 w-24 text-center cursor-pointer" @click="openBookDetail(book)">
                                <div
                                    class="aspect-[3/4] bg-gradient-to-br from-gray-200 to-gray-300 rounded mb-2 overflow-hidden relative">
                                    <img :src="book.cover" class="w-full h-full object-cover">
                                    <div v-if="book.isPremium && !userInfo.isVip" class="absolute top-1 right-1 bg-red-500 text-white text-xs px-1.5 py-0.5 rounded">
                                        会员
                                    </div>
                                </div>
                                <p class="text-xs text-gray-700 truncate">{{ book.title }}</p>
                                <div class="w-full bg-gray-200 rounded-full h-1 mt-1">
                                    <div class="bg-indigo-600 h-1 rounded-full" :style="{width: book.progress + '%'}">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- 书籍详情模态框 -->
        <div v-if="selectedBook" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
            <div class="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-start mb-6">
                        <h2 class="text-3xl font-bold text-gray-800">{{ selectedBook.title }}</h2>
                        <div v-if="selectedBook.isPremium && !userInfo.isVip" class="bg-red-500 text-white text-sm px-3 py-1 rounded-full flex items-center">
                            <i class="fas fa-crown mr-1"></i>
                            <span>会员专享</span>
                        </div>
                        <button @click="selectedBook = null" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-2xl"></i>
                        </button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <div
                                class="aspect-[3/4] bg-gradient-to-br from-gray-200 to-gray-300 rounded-lg mb-4 overflow-hidden">
                                <img :src="selectedBook.cover" :alt="selectedBook.title"
                                    class="w-full h-full object-cover">
                            </div>
                            <div class="space-y-2 text-sm">
                                <p><span class="font-semibold">作者:</span> {{ selectedBook.author }}</p>
                                <p><span class="font-semibold">出版社:</span> {{ selectedBook.publisher }}</p>
                                <p><span class="font-semibold">出版日期:</span> {{ selectedBook.publishDate }}</p>
                                <p><span class="font-semibold">页数:</span> {{ selectedBook.pages }}</p>
                                <p><span class="font-semibold">ISBN:</span> {{ selectedBook.isbn }}</p>
                            </div>
                        </div>

                        <div class="md:col-span-2">
                            <div class="mb-6">
                                <h3 class="text-xl font-semibold mb-3">书籍简介</h3>
                                <p class="text-gray-700 leading-relaxed">{{ selectedBook.description }}</p>
                            </div>

                            <div class="mb-6">
                                <div class="flex items-center space-x-4 mb-4">
                                    <div class="flex items-center space-x-2">
                                        <star-rating v-model="userRating" :readonly="false"></star-rating>
                                        <span class="text-lg font-semibold">{{ userRating }}/5</span>
                                    </div>
                                    <button
                                        class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition"
                                        @click="submitRating">
                                        提交评分
                                    </button>
                                </div>

                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h4 class="font-semibold mb-2">写评论</h4>
                                    <textarea
                                        class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                        rows="3" placeholder="分享你的阅读感受..." v-model="commentContent"></textarea>
                                    <button
                                        class="mt-3 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition"
                                        @click="submitComment">
                                        发布评论
                                    </button>
                                </div>
                            </div>

                            <!-- 评论列表 -->
                            <div>
                                <h4 class="font-semibold mb-4">读者评论</h4>
                                <div class="space-y-4">
                                    <div class="border-b border-gray-100 pb-4"
                                        v-for="(comment, idx) in selectedBook.comments" :key="idx">
                                        <div class="flex items-center space-x-2 mb-2">
                                            <img :src="comment.avatar" alt="用户头像" class="w-8 h-8 rounded-full">
                                            <span class="font-medium">{{ comment.username }}</span>
                                            <span v-if="comment.isVip" class="text-xs px-1.5 py-0.5 rounded-full vip-badge">VIP</span>
                                            <star-rating :rating="comment.rating" :readonly="true"></star-rating>
                                        </div>
                                        <p class="text-gray-700">{{ comment.content }}</p>
                                    </div>
                                </div>
                            </div>

                            <!-- 加入书架按钮 -->
                            <button
                                class="mt-6 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition"
                                @click="addToShelf" v-if="isLoggedIn && !isInShelf && (userInfo.isVip || myShelfBooks.length < 10)">
                                加入书架
                            </button>
                            <button
                                class="mt-6 bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition cursor-not-allowed"
                                v-if="isLoggedIn && isInShelf">
                                已在书架
                            </button>
                            <button
                                class="mt-6 bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition"
                                v-if="isLoggedIn && !isInShelf && !userInfo.isVip && myShelfBooks.length >= 10"
                                @click="showVipModal">
                                升级会员解锁更多收藏
                            </button>
                            <button
                                class="mt-6 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition"
                                v-else @click="showLoginModal">
                                登录后加入书架
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 会员充值模态框 -->
        <div v-if="showVip" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
            <div class="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-start mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">BookHub 会员充值</h2>
                        <button @click="showVip = false" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-2xl"></i>
                        </button>
                    </div>

                    <div v-if="userInfo.isVip" class="text-center py-8 mb-6 bg-green-50 rounded-lg">
                        <i class="fas fa-crown text-5xl text-yellow-500 mb-4"></i>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">您已是会员</h3>
                        <p class="text-gray-600">会员有效期至: {{ userInfo.vipExpireDate }}</p>
                        <button class="mt-4 bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 transition" @click="extendVip">
                            续费会员
                        </button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div v-for="plan in vipPlans" :key="plan.id" class="plan-card border border-gray-200 rounded-lg p-6" :class="{ 'highlight': plan.isRecommended }">
                            <div class="text-center mb-4">
                                <h3 class="font-bold text-xl text-gray-800">{{ plan.name }}</h3>
                                <div class="mt-2">
                                    <span class="text-3xl font-bold text-indigo-600">¥{{ plan.price }}</span>
                                    <span class="text-gray-500">/{{ plan.period }}</span>
                                </div>
                                <p class="text-sm text-gray-500 mt-1">{{ plan.saveTip }}</p>
                            </div>
                            <ul class="space-y-2 mb-6">
                                <li class="flex items-start">
                                    <i class="fas fa-check text-green-500 mt-1 mr-2"></i>
                                    <span class="text-sm text-gray-600">{{ plan.benefits[0] }}</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-check text-green-500 mt-1 mr-2"></i>
                                    <span class="text-sm text-gray-600">{{ plan.benefits[1] }}</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-check text-green-500 mt-1 mr-2"></i>
                                    <span class="text-sm text-gray-600">{{ plan.benefits[2] }}</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-check text-green-500 mt-1 mr-2"></i>
                                    <span class="text-sm text-gray-600">{{ plan.benefits[3] }}</span>
                                </li>
                            </ul>
                            <button class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition" @click="selectVipPlan(plan.id)">
                                选择此套餐
                            </button>
                        </div>
                    </div>

                    <div v-if="selectedPlanId !== null" class="bg-gray-50 p-6 rounded-lg">
                        <h3 class="font-bold text-lg text-gray-800 mb-4">支付方式</h3>
                        <div class="space-y-4">
                            <div class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:border-indigo-500 transition" @click="selectPaymentMethod('wechat')">
                                <input type="radio" name="payment" id="wechat" class="mr-3" :checked="paymentMethod === 'wechat'">
                                <label for="wechat" class="flex items-center w-full cursor-pointer">
                                    <i class="fab fa-weixin text-green-500 text-2xl mr-3"></i>
                                    <span>微信支付</span>
                                </label>
                            </div>
                            <div class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:border-indigo-500 transition" @click="selectPaymentMethod('alipay')">
                                <input type="radio" name="payment" id="alipay" class="mr-3" :checked="paymentMethod === 'alipay'">
                                <label for="alipay" class="flex items-center w-full cursor-pointer">
                                    <i class="fab fa-alipay text-blue-500 text-2xl mr-3"></i>
                                    <span>支付宝</span>
                                </label>
                            </div>
                            <div class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:border-indigo-500 transition" @click="selectPaymentMethod('credit')">
                                <input type="radio" name="payment" id="credit" class="mr-3" :checked="paymentMethod === 'credit'">
                                <label for="credit" class="flex items-center w-full cursor-pointer">
                                    <i class="fas fa-credit-card text-gray-600 text-2xl mr-3"></i>
                                    <span>银行卡支付</span>
                                </label>
                            </div>
                        </div>
                        <button class="mt-6 w-full bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700 transition font-semibold" @click="confirmPayment">
                            确认支付 ¥{{ selectedPlanPrice }}
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 登录模态框 -->
        <div v-if="showLogin" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
            <div class="bg-white rounded-lg max-w-md w-full">
                <div class="p-6">
                    <div class="flex justify-between items-start mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">登录/注册</h2>
                        <button @click="showLogin = false" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>

                    <form @submit.prevent="handleLogin">
                        <div class="mb-4">
                            <label for="username" class="block text-gray-700 mb-2">用户名</label>
                            <input type="text" id="username"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                v-model="loginUsername" required>
                        </div>

                        <div class="mb-6">
                            <label for="password" class="block text-gray-700 mb-2">密码</label>
                            <input type="password" id="password"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                v-model="loginPassword" required>
                        </div>

                        <div class="flex justify-between items-center mb-6">
                            <div class="flex items-center">
                                <input type="checkbox" id="remember" class="mr-2">
                                <label for="remember" class="text-gray-600 text-sm">记住我</label>
                            </div>
                            <a href="#" class="text-indigo-600 hover:text-indigo-800 text-sm">忘记密码？</a>
                        </div>

                        <button type="submit"
                            class="w-full bg-indigo-600 text-white px-4 py-3 rounded-lg hover:bg-indigo-700 transition font-semibold">
                            登录
                        </button>

                        <div class="text-center mt-4 text-gray-600 text-sm">
                            还没有账号？<a href="#" class="text-indigo-600 hover:text-indigo-800">立即注册</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.7/dist/axios.min.js"></script>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    loginMode: 'login',
                    registerUsername: '',
                    registerEmail: '',
                    registerPassword: '',
                    registerPasswordConfirm: '',
                    mobileMenuOpen: false,
                    selectedBook: null,
                    userRating: 0,
                    commentContent: '',
                    searchKeyword: '',
                    recommendedBooks: [
                        {
                            id: 1,
                            title: "JavaScript高级程序设计",
                            author: "尼古拉斯·泽卡斯",
                            rating: 4.8,
                            reviews: 1243,
                            cover: "https://ts1.tc.mm.bing.net/th/id/R-C.65e79b2f99aa01c8d00f99dce25ab47f?rik=dreHnFmLVRxApA&riu=http%3a%2f%2fimg35.ddimg.cn%2f76%2f19%2f20884225-1_u_2.jpg&ehk=%2fwPrcuk4GjMV4ke%2fS3hlIGJiNa5Bx5zVY95eW13zfdg%3d&risl=&pid=ImgRaw&r=0",
                            isPremium: false
                        },
                        {
                            id: 2,
                            title: "人类简史",
                            author: "尤瓦尔·赫拉利",
                            rating: 4.6,
                            reviews: 2356,
                            cover: "https://img.alicdn.com/i2/2543812659/O1CN01AgGsjU1VVrswdhd42_!!2543812659.jpg",
                            isPremium: true
                        },
                        {
                            id: 3,
                            title: "三体",
                            author: "刘慈欣",
                            rating: 4.9,
                            reviews: 5678,
                            cover: "https://p1.ssl.qhimg.com/t0147ec1b07078c0cf8.jpg",
                            isPremium: false
                        },
                        {
                            id: 4,
                            title: "活着",
                            author: "余华",
                            rating: 4.7,
                            reviews: 3456,
                            cover: "https://ts2.tc.mm.bing.net/th/id/OIP-C.8Mb1Jm08nNYWyVcoddsZqwHaJ3?cb=12&rs=1&pid=ImgDetMain&o=7&rm=3",
                            isPremium: false
                        }
                    ],
                    popularBooks: [
                        {
                            id: 11,
                            title: "解忧杂货店",
                            author: "东野圭吾",
                            rating: 4.8,
                            genre: "小说",
                            heat: 98,
                            reviews: 8765,
                            reading: 1234,
                            cover: "https://ts1.tc.mm.bing.net/th/id/OIP-C.v-_BhEb7l5KWQyHuqOmmngHaHV?cb=12&rs=1&pid=ImgDetMain&o=7&rm=3",
                            isPremium: false
                        },
                        {
                            id: 12,
                            title: "百年孤独",
                            author: "加西亚·马尔克斯",
                            rating: 4.7,
                            genre: "小说",
                            heat: 95,
                            reviews: 7654,
                            reading: 1098,
                            cover: "https://so1.360tres.com/t017c401645dd63e333.png",
                            isPremium: true
                        },
                        {
                            id: 13,
                            title: "影响力",
                            author: "罗伯特·西奥迪尼",
                            rating: 4.9,
                            genre: "心理学",
                            heat: 92,
                            reviews: 6543,
                            reading: 987,
                            cover: "https://pica.zhimg.com/v2-ab9d0d8626207673c986e7b372c75974_720w.jpg?source=172ae18b",
                            isPremium: false
                        },
                        {
                            id: 14,
                            title: "明朝那些事儿",
                            author: "当年明月",
                            rating: 4.9,
                            genre: "历史",
                            heat: 90,
                            reviews: 9876,
                            reading: 1567,
                            cover: "https://p1.ssl.qhimg.com/t0125a05a1f6442097e.jpg",
                            isPremium: true
                        }
                    ],
                    categories: ['全部', '小说', '科技', '历史', '传记', '心理学'],
                    selectedCategory: '全部',
                    filteredBooks: [
                        {
                            id: 21,
                            title: "追风筝的人",
                            author: "卡勒德·胡赛尼",
                            rating: 4.8,
                            reviews: 7654,
                            category: "小说",
                            cover: "https://picx.zhimg.com/v2-fea6f7055effc5edf256ae5875c42694_720w.jpg?source=172ae18b",
                            isPremium: false
                        },
                        {
                            id: 22,
                            title: "白夜行",
                            author: "东野圭吾",
                            rating: 4.7,
                            reviews: 6543,
                            category: "小说",
                            cover: "https://ts3.tc.mm.bing.net/th/id/OIP-C.-oMw4HZKTRTFrnAXhML48AHaHa?cb=12&rs=1&pid=ImgDetMain&o=7&rm=3",
                            isPremium: false
                        },
                        {
                            id: 23,
                            title: "Python编程",
                            author: "埃里克·马瑟斯",
                            rating: 4.8,
                            reviews: 5432,
                            category: "科技",
                            cover: "https://booklibimg.kfzimg.com/data/book_lib_img_v2/isbn/0/cf65/cf658bc055dbdf070b4b6be038bba380_0_0_0_0_water.jpg",
                            isPremium: true
                        },
                        {
                            id: 24,
                            title: "明朝那些事儿",
                            author: "当年明月",
                            rating: 4.6,
                            reviews: 4321,
                            category: "历史",
                            cover: "https://p1.ssl.qhimg.com/t0125a05a1f6442097e.jpg",
                            isPremium: true
                        },
                        {
                            id: 25,
                            title: "史蒂夫·乔布斯传",
                            author: "沃尔特·艾萨克森",
                            rating: 4.7,
                            reviews: 3210,
                            category: "传记",
                            cover: "https://ts4.tc.mm.bing.net/th/id/OIP-C.AxWQ45apjH9rhFcwVTj8egHaKO?cb=12&rs=1&pid=ImgDetMain&o=7&rm=3",
                            isPremium: false
                        },
                        {
                            id: 26,
                            title: "社会心理学",
                            author: "戴维·迈尔斯",
                            rating: 4.9,
                            reviews: 4567,
                            category: "心理学",
                            cover: "https://ts1.tc.mm.bing.net/th/id/OIP-C.SsmjxYsB0y_k5OjKpznCKQHaJ_?cb=12&rs=1&pid=ImgDetMain&o=7&rm=3",
                            isPremium: true
                        }
                    ],
                    readingStats: {
                        total: 24,
                        thisMonth: 3,
                        avgRating: 4.5
                    },
                    currentlyReading: [
                        {
                            id: 31,
                            title: "思考，快与慢",
                            progress: 35,
                            cover: "https://dh.woshipm.com/wp-content/uploads/2022/01/1900338879_ii_cover.jpeg",
                            isPremium: false
                        },
                        {
                            id: 32,
                            title: "Python编程：从入门到实践",
                            progress: 67,
                            cover: "https://booklibimg.kfzimg.com/data/book_lib_img_v2/isbn/0/cf65/cf658bc055dbdf070b4b6be038bba380_0_0_0_0_water.jpg",
                            isPremium: true
                        },
                        {
                            id: 33,
                            title: "红楼梦",
                            progress: 12,
                            cover: "https://ts2.tc.mm.bing.net/th/id/OIP-C.P-X1Ubk9KAx2eNUPWL2TAwHaFj?cb=12&rs=1&pid=ImgDetMain&o=7&rm=3",
                            isPremium: false
                        }
                    ],
                    myShelfBooks: [
                        {
                            id: 31,
                            title: "思考，快与慢",
                            author: "丹尼尔·卡尼曼",
                            rating: 4.7,
                            reviews: 5678,
                            cover: "https://dh.woshipm.com/wp-content/uploads/2022/01/1900338879_ii_cover.jpeg"
                        },
                        {
                            id: 32,
                            title: "Python编程：从入门到实践",
                            author: "埃里克·马瑟斯",
                            rating: 4.8,
                            reviews: 4567,
                            cover: "https://booklibimg.kfzimg.com/data/book_lib_img_v2/isbn/0/cf65/cf658bc055dbdf070b4b6be038bba380_0_0_0_0_water.jpg"
                        }
                    ],
                    showLogin: false,
                    loginUsername: '',
                    loginPassword: '',
                    isLoggedIn: false,
                    isInShelf: false,
                    // 新增会员相关数据
                    showVip: false,
                    userInfo: {
                        isVip: false,
                        vipExpireDate: "2023-12-31"
                    },
                    vipPlans: [
                        {
                            id: 1,
                            name: "月度会员",
                            price: 19,
                            period: "月",
                            saveTip: "每月节省¥5",
                            isRecommended: false,
                            benefits: [
                                "无限阅读所有书籍",
                                "支持离线下载",
                                "每月1本免费电子书",
                                "书架容量无限制"
                            ]
                        },
                        {
                            id: 2,
                            name: "年度会员",
                            price: 198,
                            period: "年",
                            saveTip: "年均节省¥20",
                            isRecommended: true,
                            benefits: [
                                "无限阅读所有书籍",
                                "支持离线下载",
                                "每月2本免费电子书",
                                "书架容量无限制",
                                "专属会员活动邀请"
                            ]
                        },
                        {
                            id: 3,
                            name: "季度会员",
                            price: 58,
                            period: "3个月",
                            saveTip: "每季节省¥9",
                            isRecommended: false,
                            benefits: [
                                "无限阅读所有书籍",
                                "支持离线下载",
                                "每月1本免费电子书",
                                "书架容量无限制"
                            ]
                        }
                    ],
                    selectedPlanId: null,
                    selectedPlanPrice: 0,
                    paymentMethod: "wechat"
                }
            },
            methods: {
                goToHome(e) {
                    e.preventDefault();
                    window.scrollTo({
                        top: 0,
                        behavior: 'smooth'
                    });
                },
                scrollToCategories() {
                    this.mobileMenuOpen = false;
                    const targetElement = document.getElementById('browse-categories');
                    if (targetElement) {
                        const rect = targetElement.getBoundingClientRect();
                        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                        const targetPosition = rect.top + scrollTop - 80;

                        window.scrollTo({
                            top: targetPosition,
                            behavior: 'smooth'
                        });
                    }
                },
                scrollToPopular(e) {
                    e.preventDefault();
                    this.mobileMenuOpen = false;
                    const targetElement = document.getElementById('popular-books');
                    if (targetElement) {
                        const rect = targetElement.getBoundingClientRect();
                        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                        const targetPosition = rect.top + scrollTop - 80;

                        window.scrollTo({
                            top: targetPosition,
                            behavior: 'smooth'
                        });
                    }
                },
                goToMyShelf(e) {
                    e.preventDefault();
                    const targetElement = document.getElementById('my-shelf');
                    if (targetElement) {
                        targetElement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });

                        if (this.mobileMenuOpen) {
                            this.mobileMenuOpen = false;
                        }
                    }
                },
                showLoginModal() {
                    this.showLogin = true;
                    this.loginMode = 'login';
                },
                // 异步登录（迁移自 Vue2 实例）
                async handleLogin() {
                    if (!this.loginUsername || !this.loginPassword) {
                        alert('请输入用户名和密码');
                        return;
                    }
                    try {
                        const res = await axios.post('http://localhost:8000/api/auth/login/', {
                            username: this.loginUsername,
                            password: this.loginPassword
                        });
                        localStorage.setItem('token', res.data.access);
                        this.isLoggedIn = true;
                        this.showLogin = false;
                        alert('登录成功！');
                        // 清理密码，只保留用户名（方便后续显示）
                        this.loginPassword = '';
                    } catch (err) {
                        alert('用户名或密码错误');
                    }
                },
                async handleRegister() {
                    if (this.registerPassword !== this.registerPasswordConfirm) {
                        alert('两次密码不一致');
                        return;
                    }
                    if (!this.registerUsername || !this.registerEmail || !this.registerPassword) {
                        alert('请填写完整注册信息');
                        return;
                    }
                    try {
                        const res = await axios.post('http://localhost:8000/api/users/', {
                            username: this.registerUsername,
                            email: this.registerEmail,
                            password: this.registerPassword
                        });
                        alert('注册成功！请登录');
                        this.loginMode = 'login';
                        this.loginUsername = this.registerUsername;
                        this.registerEmail = '';
                        this.registerPassword = '';
                        this.registerPasswordConfirm = '';
                    } catch (err) {
                        const error = err.response?.data || '注册失败';
                        alert(typeof error === 'string' ? error : JSON.stringify(error));
                    }
                },
                switchToRegister() {
                    this.loginMode = 'register';
                },
                switchToLogin() {
                    this.loginMode = 'login';
                },
                handleSearch() {
                    const keyword = this.searchKeyword.trim().toLowerCase();
                    if (!keyword) {
                        this.recommendedBooks = [
                            { id: 1, title: "JavaScript高级程序设计", author: "尼古拉斯·泽卡斯", rating: 4.8, reviews: 1243, cover: "https://ts1.tc.mm.bing.net/th/id/R-C.65e79b2f99aa01c8d00f99dce25ab47f?rik=dreHnFmLVRxApA&riu=http%3a%2f%2fimg35.ddimg.cn%2f76%2f19%2f20884225-1_u_2.jpg&ehk=%2fwPrcuk4GjMV4ke%2fS3hlIGJiNa5Bx5zVY95eW13zfdg%3d&risl=&pid=ImgRaw&r=0", isPremium: false },
                            { id: 2, title: "人类简史", author: "尤瓦尔·赫拉利", rating: 4.6, reviews: 2356, cover: "https://img.alicdn.com/i2/2543812659/O1CN01AgGsjU1VVrswdhd42_!!2543812659.jpg", isPremium: true },
                            { id: 3, title: "三体", author: "刘慈欣", rating: 4.9, reviews: 5678, cover: "https://p1.ssl.qhimg.com/t0147ec1b07078c0cf8.jpg", isPremium: false },
                            { id: 4, title: "活着", author: "余华", rating: 4.7, reviews: 3456, cover: "https://ts2.tc.mm.bing.net/th/id/OIP-C.8Mb1Jm08nNYWyVcoddsZqwHaJ3?cb=12&rs=1&pid=ImgDetMain&o=7&rm=3", isPremium: false }
                        ];
                        return;
                    }
                    this.recommendedBooks = [
                        { id: 1, title: "JavaScript高级程序设计", author: "尼古拉斯·泽卡斯", rating: 4.8, reviews: 1243, cover: "https://ts1.tc.mm.bing.net/th/id/R-C.65e79b2f99aa01c8d00f99dce25ab47f?rik=dreHnFmLVRxApA&riu=http%3a%2f%2fimg35.ddimg.cn%2f76%2f19%2f20884225-1_u_2.jpg&ehk=%2fwPrcuk4GjMV4ke%2fS3hlIGJiNa5Bx5zVY95eW13zfdg%3d&risl=&pid=ImgRaw&r=0", isPremium: false },
                        { id: 2, title: "人类简史", author: "尤瓦尔·赫拉利", rating: 4.6, reviews: 2356, cover: "https://img.alicdn.com/i2/2543812659/O1CN01AgGsjU1VVrswdhd42_!!2543812659.jpg", isPremium: true },
                        { id: 3, title: "三体", author: "刘慈欣", rating: 4.9, reviews: 5678, cover: "https://p1.ssl.qhimg.com/t0147ec1b07078c0cf8.jpg", isPremium: false },
                        { id: 4, title: "活着", author: "余华", rating: 4.7, reviews: 3456, cover: "https://ts2.tc.mm.bing.net/th/id/OIP-C.8Mb1Jm08nNYWyVcoddsZqwHaJ3?cb=12&rs=1&pid=ImgDetMain&o=7&rm=3", isPremium: false }
                    ].filter(book =>
                        book.title.toLowerCase().includes(keyword) ||
                        book.author.toLowerCase().includes(keyword)
                    );
                },
                showRecommendations() {
                    this.mobileMenuOpen = false;
                    const recommendSection = document.querySelector('section:nth-of-type(3) h3');
                    if (recommendSection) {
                        const navHeight = document.querySelector('nav').offsetHeight;
                        const rect = recommendSection.getBoundingClientRect();
                        const targetPosition = rect.top + window.pageYOffset - navHeight;
                        window.scrollTo({
                            top: targetPosition,
                            behavior: 'smooth'
                        });
                    }
                },
                loadMoreRecommendations() {
                    this.recommendedBooks.push(
                        { id: 5, title: "月亮与六便士", author: "毛姆", rating: 4.6, reviews: 2109, cover: "https://ts4.tc.mm.bing.net/th/id/OIP-C.4bAdd7-IibHI8w3SD3kWQwHaJb?cb=12&rs=1&pid=ImgDetMain&o=7&rm=3", isPremium: false },
                        { id: 6, title: "哈利波特与魔法石", author: "J.K.罗琳", rating: 4.9, reviews: 12345, cover: "https://c-ssl.duitang.com/uploads/item/201709/25/20170925180550_jdGth.jpeg", isPremium: true }
                    );
                    alert('已加载更多推荐书籍！');
                },
                showFullRanking() {
                    window.location.href = 'ranking.html'; 
                },
                filterByCategory(category) {
                    this.selectedCategory = category;
                    const allBooks = [
                        { id: 21, title: "追风筝的人", author: "卡勒德·胡赛尼", rating: 4.8, reviews: 7654, category: "小说", cover: "https://picx.zhimg.com/v2-fea6f7055effc5edf256ae5875c42694_720w.jpg?source=172ae18b", isPremium: false },
                        { id: 22, title: "白夜行", author: "东野圭吾", rating: 4.7, reviews: 6543, category: "小说", cover: "https://ts3.tc.mm.bing.net/th/id/OIP-C.-oMw4HZKTRTFrnAXhML48AHaHa?cb=12&rs=1&pid=ImgDetMain&o=7&rm=3", isPremium: false },
                        { id: 23, title: "Python编程", author: "埃里克·马瑟斯", rating: 4.8, reviews: 5432, category: "科技", cover: "https://booklibimg.kfzimg.com/data/book_lib_img_v2/isbn/0/cf65/cf658bc055dbdf070b4b6be038bba380_0_0_0_0_water.jpg", isPremium: true },
                        { id: 24, title: "明朝那些事儿", author: "当年明月", rating: 4.6, reviews: 4321, category: "历史", cover: "https://p1.ssl.qhimg.com/t0125a05a1f6442097e.jpg", isPremium: true },
                        { id: 25, title: "史蒂夫·乔布斯传", author: "沃尔特·艾萨克森", rating: 4.7, reviews: 3210, category: "传记", cover: "https://ts4.tc.mm.bing.net/th/id/OIP-C.AxWQ45apjH9rhFcwVTj8egHaKO?cb=12&rs=1&pid=ImgDetMain&o=7&rm=3", isPremium: false },
                        { id: 26, title: "社会心理学", author: "戴维·迈尔斯", rating: 4.9, reviews: 4567, category: "心理学", cover: "https://ts1.tc.mm.bing.net/th/id/OIP-C.SsmjxYsB0y_k5OjKpznCKQHaJ_?cb=12&rs=1&pid=ImgDetMain&o=7&rm=3", isPremium: true }
                    ];
                    this.filteredBooks = category === '全部'
                        ? allBooks
                        : allBooks.filter(book => book.category === category);
                },
                showAllReadingHistory() {
                    alert('完整阅读记录页面开发中，即将上线！');
                },
                openBookDetail(book) {
                    const detailedBook = {
                        ...book,
                        publisher: "示例出版社",
                        publishDate: "2023-01-15",
                        pages: 320,
                        isbn: "9787111111111",
                        description: "这是一本非常精彩的书籍，讲述了许多引人入胜的故事和深刻的见解。阅读这本书将带给你全新的视角和思考方式，是一本值得反复品读的好书。",
                        comments: [
                            {
                                avatar: "https://picsum.photos/id/1005/40/40",
                                username: "读者甲",
                                rating: 4,
                                content: "这是一本非常精彩的书，内容深刻，让我收获良多。强烈推荐给大家！",
                                isVip: true
                            },
                            {
                                avatar: "https://picsum.photos/id/1012/40/40",
                                username: "读者乙",
                                rating: 5,
                                content: "作者的观点很独特，叙述方式也很吸引人，是我今年读过的最好的一本书。",
                                isVip: false
                            }
                        ]
                    };
                    this.selectedBook = detailedBook;
                    this.userRating = 0;
                    this.commentContent = '';
                    this.isInShelf = this.myShelfBooks.some(shelfBook => shelfBook.id === book.id);
                },
                submitRating() {
                    if (this.userRating === 0) {
                        alert('请先给出评分！');
                        return;
                    }
                    alert(`已为《${this.selectedBook.title}》提交评分：${this.userRating}星`);
                    this.selectedBook = null;
                },
                submitComment() {
                    if (!this.commentContent.trim()) {
                        alert('请输入评论内容！');
                        return;
                    }
                    this.selectedBook.comments.push({
                        avatar: "https://picsum.photos/id/1025/40/40",
                        username: "我",
                        rating: this.userRating || 5,
                        content: this.commentContent,
                        isVip: this.userInfo.isVip
                    });
                    alert('评论发布成功！');
                    this.commentContent = '';
                },
                addToShelf() {
                    if (!this.myShelfBooks.some(book => book.id === this.selectedBook.id)) {
                        // 检查是否达到普通用户收藏上限
                        if (!this.userInfo.isVip && this.myShelfBooks.length >= 10) {
                            this.showVipModal();
                            return;
                        }

                        this.myShelfBooks.push({
                            id: this.selectedBook.id,
                            title: this.selectedBook.title,
                            author: this.selectedBook.author,
                            rating: this.selectedBook.rating,
                            reviews: this.selectedBook.reviews,
                            cover: this.selectedBook.cover
                        });
                        this.isInShelf = true;
                        alert('已成功加入书架！');
                    }
                },
                removeFromShelf(bookId) {
                    this.myShelfBooks = this.myShelfBooks.filter(book => book.id !== bookId);
                    alert('已从书架移除！');
                },
                browseBooks() {
                    document.querySelector('section:nth-of-type(5)').scrollIntoView({ behavior: 'smooth' });
                },
                // 新增会员相关方法
                showVipModal() {
                    this.showVip = true;
                    this.selectedPlanId = null;
                    this.selectedPlanPrice = 0;
                    this.paymentMethod = "wechat";
                },
                selectVipPlan(planId) {
                    this.selectedPlanId = planId;
                    const selectedPlan = this.vipPlans.find(plan => plan.id === planId);
                    if (selectedPlan) {
                        this.selectedPlanPrice = selectedPlan.price;
                    }
                },
                selectPaymentMethod(method) {
                    this.paymentMethod = method;
                },
                confirmPayment() {
                    if (!this.selectedPlanId) {
                        alert('请先选择会员套餐');
                        return;
                    }

                    if (!this.isLoggedIn) {
                        alert('请先登录');
                        this.showVip = false;
                        this.showLoginModal();
                        return;
                    }

                    // 模拟支付成功
                    const selectedPlan = this.vipPlans.find(plan => plan.id === this.selectedPlanId);
                    let monthsToAdd = 0;

                    switch(selectedPlan.period) {
                        case "月":
                            monthsToAdd = 1;
                            break;
                        case "3个月":
                            monthsToAdd = 3;
                            break;
                        case "年":
                            monthsToAdd = 12;
                            break;
                    }

                    // 更新会员有效期
                    const today = new Date();
                    today.setMonth(today.getMonth() + monthsToAdd);
                    this.userInfo.vipExpireDate = today.toLocaleDateString();
                    this.userInfo.isVip = true;

                    this.showVip = false;
                    alert(`会员开通成功！有效期至${this.userInfo.vipExpireDate}`);
                },
                extendVip() {
                    this.selectedPlanId = 2; // 默认选择年度会员
                    const selectedPlan = this.vipPlans.find(plan => plan.id === this.selectedPlanId);
                    this.selectedPlanPrice = selectedPlan.price;
                }
            }
        }).component('star-rating', {
            props: ['rating', 'readonly', 'modelValue'],
            emits: ['update:modelValue'],
            template: `
            <div class="star-rating">
                <i
                    v-for="i in 5"
                    :key="i"
                    class="star fas fa-star"
                    :class="{ 'filled': i <= currentRating }"
                    @click="handleClick(i)"
                    :style="{ cursor: readonly ? 'default' : 'pointer' }"
                ></i>
            </div>
        `,
            computed: {
                currentRating: {
                    get() {
                        return this.modelValue !== undefined ? this.modelValue : this.rating;
                    },
                    set(value) {
                        this.$emit('update:modelValue', value);
                    }
                }
            },
            methods: {
                handleClick(i) {
                    if (!this.readonly) {
                        this.currentRating = i;
                    }
                }
            }
        }).mount('#app');
    </script>
</body>

</html>
